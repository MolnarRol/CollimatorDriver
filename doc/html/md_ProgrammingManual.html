<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Collimator blade driver: ProgrammingManual</title>
<link rel="icon" href="logo_small.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo_big.png"/></td>
  <td id="projectalign">
   <div id="projectname">Collimator blade driver<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">Embeded software for Collimator blade position control</div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_ProgrammingManual.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ProgrammingManual</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md10">Software design manual</a><ul><li class="level2"><a href="#autotoc_md11">General guildline</a></li>
<li class="level2"><a href="#autotoc_md12">Data types</a></li>
<li class="level2"><a href="#autotoc_md13">Variables</a><ul><li class="level3"><a href="#autotoc_md14">Variable names</a></li>
<li class="level3"><a href="#autotoc_md15">Global variables</a></li>
<li class="level3"><a href="#autotoc_md16">Static variables</a></li>
<li class="level3"><a href="#autotoc_md17">Variables containing units</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md18">Enumeration (Enums)</a></li>
<li class="level2"><a href="#autotoc_md19">Functions</a><ul><li class="level3"><a href="#autotoc_md20">Naming the functions</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md21">Pointers</a></li>
<li class="level2"><a href="#autotoc_md22">Defines and macros</a></li>
<li class="level2"><a href="#autotoc_md23">Comments</a><ul><li class="level3"><a href="#autotoc_md24">File comments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md10"></a>
Software design manual</h1>
<h2><a class="anchor" id="autotoc_md11"></a>
General guildline</h2>
<ul>
<li>Do not use dynamic allocation (calloc, malloc)</li>
<li>Always specify data type of variables and function return values.</li>
<li>Limit mixing math operations with multiple data types. Use casting if necessary.</li>
<li>Good comments make the code more readable.</li>
<li>Do not use magic numbers (constant literals) in code. Replace them with defines.</li>
<li>Variable that must remain constant declare as such (<code>const</code>). </li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Data types</h2>
<p>Defined in <code><a class="el" href="app__types_8h.html" title="Application common variable typedefs and variable limits.">app_types.h</a></code>: </p><div class="fragment"><div class="line">#include &quot;app_types.h&quot;</div>
</div><!-- fragment --> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Data type   </th><th class="markdownTableHeadNone">Naming postfix   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>BOOL</code>   </td><td class="markdownTableBodyNone"><code>_b</code>   </td><td class="markdownTableBodyNone">boolean    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>U16</code>   </td><td class="markdownTableBodyNone"><code>_U16</code>   </td><td class="markdownTableBodyNone">unsigned 16-bit integer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>S16</code>   </td><td class="markdownTableBodyNone"><code>_S16</code>   </td><td class="markdownTableBodyNone">signed 16-bit integer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>U32</code>   </td><td class="markdownTableBodyNone"><code>_U32</code>   </td><td class="markdownTableBodyNone">unsigned 32-bit integer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>S32</code>   </td><td class="markdownTableBodyNone"><code>_S32</code>   </td><td class="markdownTableBodyNone">signed 32-bit integer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>U64</code>   </td><td class="markdownTableBodyNone"><code>_U64</code>   </td><td class="markdownTableBodyNone">unsigned 64-bit integer    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>S64</code>   </td><td class="markdownTableBodyNone"><code>_S64</code>   </td><td class="markdownTableBodyNone">signed 64-bit integer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>F32</code>   </td><td class="markdownTableBodyNone"><code>_F32</code>   </td><td class="markdownTableBodyNone">single precision float   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md13"></a>
Variables</h2>
<p>All variables must be self explanatory, ideally short but specific. </p><div class="fragment"><div class="line">(s_)(MODULE)_{name_of_the_variable}(__unit_){_VariableType}</div>
<div class="line"> |     |                   &#39;-&gt; If the variable is unit</div>
<div class="line"> |     &#39;---------------------------------&gt; If the variable is global    </div>
<div class="line"> &#39;---------------------------------------&gt; If the variable is static</div>
</div><!-- fragment --><p> If the variable <b>must not be seen outside of the module</b>, then use <code>static</code> keyword. Keyword <code>volatile</code> is <b>recommended to use with variables with asynchronous access</b> (in interrupts).</p>
<h3><a class="anchor" id="autotoc_md14"></a>
Variable names</h3>
<p>All variables names are written in <a href="https://en.wikipedia.org/wiki/Snake_case">snake case</a>. Example: </p><div class="fragment"><div class="line">your_variable_name</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md15"></a>
Global variables</h3>
<p>If the variable is global (static included), then they should contain prefix with module name. <b>Local variables are without this prefix</b>. For example: </p><div class="fragment"><div class="line">U16 MODULE_some_global_variable_U16;            /* Global variable. */</div>
<div class="line"> </div>
<div class="line">void fun(void)</div>
<div class="line">{</div>
<div class="line">    U32 tmp_val_U32;                /* Local variable. */</div>
<div class="line">    static U16 s_last_index_U16;            /* Static local variable. */</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md16"></a>
Static variables</h3>
<p>Static variables are marked with <code>s_</code> prefix. If the variable is <b>global</b>, then the module name comes after the prefix like so: </p><div class="fragment"><div class="line">static U32 s_MODULE_name_of_the_variable_U32;       /* Static variable. */</div>
<div class="line"> </div>
<div class="line">void fun(void)</div>
<div class="line">{</div>
<div class="line">    static U16 s_last_index_U16;            /* Static local variable. */</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md17"></a>
Variables containing units</h3>
<p>For better code readability we should include physical dimension of a unit that we want to represent with a variable. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Unit   </th><th class="markdownTableHeadNone">Variable Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{V}$   </td><td class="markdownTableBodyNone"><code>__V__</code>   </td><td class="markdownTableBodyNone">Volt    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">$\mathrm{A}$   </td><td class="markdownTableBodyNone"><code>__A__</code>   </td><td class="markdownTableBodyNone">Ampere    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{Nm}$   </td><td class="markdownTableBodyNone"><code>__Nm__</code>   </td><td class="markdownTableBodyNone">Newton meter    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">$\mathrm{kg.m^2}$   </td><td class="markdownTableBodyNone"><code>__kgm2__</code>   </td><td class="markdownTableBodyNone">Moment of inertia    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{rad.s^{-1}}$   </td><td class="markdownTableBodyNone"><code>__rad_s1__</code>   </td><td class="markdownTableBodyNone">Angular velocity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">%   </td><td class="markdownTableBodyNone"><code>__per_cent__</code>   </td><td class="markdownTableBodyNone">percent    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">‰   </td><td class="markdownTableBodyNone"><code>__pro_mile__</code>   </td><td class="markdownTableBodyNone">promile   </td></tr>
</table>
<p>We can also use unit prefixes: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Unit   </th><th class="markdownTableHeadNone">Variable Name   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{M}$   </td><td class="markdownTableBodyNone"><code>__M&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">Mega    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">$\mathrm{k}$   </td><td class="markdownTableBodyNone"><code>__k&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">kilo    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{m}$   </td><td class="markdownTableBodyNone"><code>__m&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">milli    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">$\mathrm{\mu}$   </td><td class="markdownTableBodyNone"><code>__u&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">micro    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">$\mathrm{n}$   </td><td class="markdownTableBodyNone"><code>__n&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">nano    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">$\mathrm{p}$   </td><td class="markdownTableBodyNone"><code>__p&lt;unit&gt;__</code>   </td><td class="markdownTableBodyNone">pico   </td></tr>
</table>
<p><b>Example:</b> </p><div class="fragment"><div class="line">F32 output_voltage__V__F32 = (F32)12.3;</div>
<div class="line">F32 output_current__mA__F32 = (F32)314;</div>
<div class="line">F32 output_power__W__F32 = output_voltage__V__F32 * output_current__mA__F32 </div>
<div class="line">                    / (F32)1000.0;</div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md18"></a>
Enumeration (Enums)</h2>
<p>When typedef-ing enum use <code>_enum</code> postfix. Each enum member has <code>_e</code> postfix. Name of each enum is in <b>capitals</b> : </p><div class="fragment"><div class="line">typedef enum</div>
<div class="line">{</div>
<div class="line">    MODULE_STATE_RUNNING_e = 0,</div>
<div class="line">    MODULE_STATE_STOPPED_e,</div>
<div class="line">    MODULE_STATE_ERROR_e </div>
<div class="line">} MODULE_my_enum_name_enum;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Functions</h2>
<p>Functions must do only one thing. If the control logic is complicated, then break down this logic to simpler and smaller units. <b>Function naming scheme:</b> </p><div class="fragment"><div class="line">{ReturnDataType} {MODULE_}{FunctionName}(__unit__)(_ReturnDataType)()</div>
<div class="line">                                |       &#39;-&gt; If the function is void, then the data type is not specified</div>
<div class="line">                            &#39;-&gt; Only if function&#39;s return value is unit.</div>
</div><!-- fragment --><p> <b>If the function has no input parameters then:</b> </p><div class="fragment"><div class="line">/* Do not. Calling the function fun() with parameters does not result in error - bad. */</div>
<div class="line">void fun()      </div>
<div class="line">{</div>
<div class="line">    /* Implementation. */</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">/* Do instead. Calling the function fun() with parameters results in error - good. */</div>
<div class="line">void fun(void)          </div>
<div class="line">{</div>
<div class="line">    /* Implementation. */</div>
<div class="line">}</div>
</div><!-- fragment --><p> <b>Static functions</b> do not have <code>s_</code> prefix.</p>
<p>When <b>passing a struct</b> to a function it is recommended to use pointer rather than copy. </p>
<h3><a class="anchor" id="autotoc_md20"></a>
Naming the functions</h3>
<p>Function names like variable names should be safe explanatory. It is up to you as a programmer to name the function, but it is a good practice to stick to standard naming of basic functions like: For example: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name   </th><th class="markdownTableHeadNone">Return void   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Get(void)</code>   </td><td class="markdownTableBodyNone">No   </td><td class="markdownTableBodyNone">Get variable value    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Set()</code>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">Set variable value    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Reset(void)</code>   </td><td class="markdownTableBodyNone">Yes   </td><td class="markdownTableBodyNone">Reset variable/struct to default value    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Calculate()</code>   </td><td class="markdownTableBodyNone">Not specified   </td><td class="markdownTableBodyNone">Calculate from provided parameters new value    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Init()</code>   </td><td class="markdownTableBodyNone">Not specified   </td><td class="markdownTableBodyNone">Initialize module    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DeInit()</code>   </td><td class="markdownTableBodyNone">Not specified   </td><td class="markdownTableBodyNone">De-initialize module   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md21"></a>
Pointers</h2>
<p>Pointers are marked with <code>_p&lt;DataType&gt;</code> suffix: </p><div class="fragment"><div class="line">U32* data_pU32 = (U32*)0;           /* Pointer to U32. */</div>
</div><!-- fragment --> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pointer to   </th><th class="markdownTableHeadNone">Notation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">data type   </td><td class="markdownTableBodyNone"><code>_p&lt;data&gt;</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">struct   </td><td class="markdownTableBodyNone"><code>_ps</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">function   </td><td class="markdownTableBodyNone"><code>_pF&lt;function return type&gt;</code>   </td></tr>
</table>
<p>*__Do not use uninitialised pointers!!!__* </p><div class="fragment"><div class="line">U16* data_pU16;</div>
<div class="line">*data_pU16 = (U16)0;        /* Results in undefined behaviour! */</div>
</div><!-- fragment --><p> Limit usage of <b>void pointers</b>.</p>
<h2><a class="anchor" id="autotoc_md22"></a>
Defines and macros</h2>
<p>Whenever the code needs to work with constant literals use defines and macros. All defines and macros are in capital letters with underscore for word separation:</p>
<p><b>Notation:</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type   </th><th class="markdownTableHeadNone">Notation(suffix)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Constant define   </td><td class="markdownTableBodyNone"><code>_d&lt;DataType&gt;</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Macro   </td><td class="markdownTableBodyNone"><code>_dM&lt;DataType&gt;</code>   </td></tr>
</table>
<p>Examples: </p><div class="fragment"><div class="line">/* Defines */</div>
<div class="line">#define GREEN_LED_PIN_dU16          ( (U16)24 )</div>
<div class="line">#define W_REG_I_dF32                ( (F32)12.64 )</div>
<div class="line"> </div>
<div class="line">/* Macros */</div>
<div class="line">#define CALC_POWER__W__dMF32(U, I)      ( (F32)(U) * (F32)(I) )</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md23"></a>
Comments</h2>
<p>All types of comments are allowed.</p>
<h3><a class="anchor" id="autotoc_md24"></a>
File comments</h3>
<p>Every <code>.c</code> and <code>.h</code> file should contain basic file description at the start: </p><div class="fragment"><div class="line">/**</div>
<div class="line"> * @file NameOfTheFile</div>
<div class="line"> * @brief BriefDescription</div>
<div class="line"> * @details DetailedDescription</div>
<div class="line"> *</div>
<div class="line"> * =================================================================</div>
<div class="line"> * @author Author1</div>
<div class="line"> * @author Author2</div>
<div class="line"> *</div>
<div class="line"> * =================================================================</div>
<div class="line"> * KEM, FEI, TUKE</div>
<div class="line"> * @date CurrentDate</div>
<div class="line"> */</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
